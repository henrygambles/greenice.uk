<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>greenice.uk</title>
  <meta name="description" content="A full-screen emerald city of green crystalline towers along the yellow brick road." />
  <style>
    :root{
      --bg0:#020a08;
      --bg1:#041a14;
      --emerald:#1cffc2;
      --emerald-deep:#00a77f;
      --emerald-dark:#0a3b2f;
      --gold:#f6d35b;
      --gold-deep:#e7a61e;
      --mist:#a6ffe6;
      --ink: rgba(255,255,255,.92);
      --shadow: rgba(0,0,0,.55);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: "Palatino Linotype", "Book Antiqua", Palatino, Garamond, Georgia, serif;
      color:var(--ink);
      background: radial-gradient(1200px 700px at 50% 10%, rgba(32,255,200,.12), transparent 60%),
                  radial-gradient(900px 800px at 30% 70%, rgba(255,210,90,.10), transparent 62%),
                  linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow:hidden;
    }

    .scene{
      position:relative;
      width:100vw;
      height:100vh;
      overflow:hidden;
      perspective: 1000px;
      background:
        radial-gradient(1000px 700px at 60% 0%, rgba(32,255,200,.12), transparent 60%),
        radial-gradient(1200px 900px at 40% 80%, rgba(255,210,90,.08), transparent 65%),
        linear-gradient(180deg, #040e0b 0%, #041a14 55%, #02130f 100%);
    }

    .aurora{
      position:absolute; inset:-20% -10% auto -10%;
      height: 65vh;
      background: conic-gradient(from 210deg at 50% 20%,
        rgba(20,255,200,.0),
        rgba(20,255,200,.18),
        rgba(255,210,90,.14),
        rgba(20,255,200,.0));
      filter: blur(18px);
      opacity:.9;
      animation: aurora 10s ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes aurora{
      0%,100%{transform:translate3d(-2%,0,0) rotate(-4deg)}
      50%{transform:translate3d(2%,2%,0) rotate(5deg)}
    }

    .mist{
      position:absolute;
      left:-10%; right:-10%;
      height: 36vh;
      bottom: 0;
      background: radial-gradient(closest-side at 50% 40%, rgba(166,255,230,.18), transparent 70%);
      filter: blur(16px);
      opacity:.65;
      pointer-events:none;
    }
    .mist.mist2{
      bottom: 10vh;
      opacity:.35;
      filter: blur(28px);
    }

    .travel{
      position:absolute; inset:0;
      transform-style: preserve-3d;
      animation: camera 12s ease-in-out infinite;
    }
    @keyframes camera{
      0%,100%{transform: translate3d(0,1vh,0) rotateZ(-1deg)}
      50%{transform: translate3d(-1vw,-1vh,0) rotateZ(1deg)}
    }

    .road{
      position:absolute;
      left:50%;
      bottom:-38vh;
      width: 180vw;
      height: 170vh;
      transform-origin: 50% 0%;
      transform: translateX(-50%) rotateX(74deg) translateZ(20px);
      border-radius: 34px;
      background:
        repeating-linear-gradient(90deg, rgba(246,211,91,.95) 0 30px, rgba(231,166,30,.90) 30px 60px),
        repeating-linear-gradient(0deg, rgba(0,0,0,.18) 0 3px, rgba(0,0,0,0) 3px 44px);
      box-shadow:
        0 40px 80px rgba(0,0,0,.55),
        inset 0 0 0 1px rgba(255,255,255,.12);
      overflow:hidden;
      animation: roadFlow 1.6s linear infinite;
    }
    .road:before{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(90deg, rgba(0,0,0,.45), rgba(0,0,0,0) 30%, rgba(0,0,0,0) 70%, rgba(0,0,0,.45));
      opacity:.55;
    }
    .road:after{
      content:"";
      position:absolute; inset:-30% -20%;
      background: linear-gradient(120deg, transparent, rgba(255,255,255,.35), transparent);
      animation: shimmer 3.5s linear infinite;
      mix-blend-mode: screen;
    }
    @keyframes roadFlow{ to{ background-position: 0 120px, 0 80px; } }
    @keyframes shimmer{ to{ transform: translateX(40%); } }

    .roadGlow{
      position:absolute;
      left:50%;
      bottom: -8vh;
      width: 90vw;
      height: 80vh;
      transform-origin: 50% 0%;
      transform: translateX(-50%) rotateX(75deg) translateZ(30px);
      background: radial-gradient(closest-side at 50% 30%, rgba(255,231,150,.55), transparent 70%);
      filter: blur(8px);
      opacity:.8;
      pointer-events:none;
    }

    .city{
      position:absolute;
      left:50%;
      bottom: 24vh;
      width: 160vw;
      height: 68vh;
      transform-style: preserve-3d;
      transform: translateX(-50%) translateZ(140px) scale(0.7);
      filter: drop-shadow(0 30px 45px rgba(0,0,0,.55));
      animation: approach 18s ease-in-out infinite;
    }
    @keyframes approach{
      0%{transform: translateX(-50%) translateY(10vh) translateZ(120px) scale(0.62); filter: blur(0.8px); opacity:0;}
      10%{opacity:1;}
      75%{transform: translateX(-50%) translateY(2vh) translateZ(240px) scale(0.9); filter: blur(0.2px); opacity:1;}
      92%{transform: translateX(-50%) translateY(-2vh) translateZ(320px) scale(1.02); opacity:.6;}
      100%{transform: translateX(-50%) translateY(12vh) translateZ(120px) scale(0.62); filter: blur(1px); opacity:0;}
    }

    .crystal{
      position:absolute;
      bottom:0;
      transform-style: preserve-3d;
      transform: translateX(-50%) translateZ(var(--z)) rotateY(var(--twist));
      background:
        linear-gradient(140deg, rgba(255,255,255,.35), rgba(32,255,200,.9) 40%, rgba(0,110,80,.45) 100%);
      border: 1px solid rgba(195,255,230,.55);
      clip-path: polygon(50% 0%, 94% 16%, 100% 60%, 86% 100%, 14% 100%, 0 60%, 6% 16%);
      box-shadow: 0 20px 60px rgba(0,0,0,.4);
      filter: drop-shadow(0 0 12px rgba(32,255,200,.4));
      opacity: var(--alpha, .9);
      animation: crystalPulse 6s ease-in-out infinite;
      animation-delay: calc(var(--i) * -0.35s);
    }
    .crystal::before{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(120deg, rgba(255,255,255,.6), transparent 70%);
      mix-blend-mode: screen;
      opacity:.55;
    }
    .crystal::after{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(20deg, rgba(255,255,255,.2), transparent 55%);
      opacity:.45;
    }
    .crystal.major{
      border-width: 1.5px;
      filter: drop-shadow(0 0 18px rgba(32,255,200,.5));
    }
    .crystal.foreground{
      bottom: -12vh;
      filter: drop-shadow(0 0 24px rgba(32,255,200,.5));
      opacity:.8;
    }
    @keyframes crystalPulse{
      0%,100%{filter: drop-shadow(0 0 10px rgba(32,255,200,.35));}
      50%{filter: drop-shadow(0 0 24px rgba(120,255,220,.7));}
    }

    canvas#spark{
      position:absolute; inset:0;
      width:100%; height:100%;
      pointer-events:none;
      mix-blend-mode: screen;
      opacity:.9;
    }

    .vignette{
      position:absolute; inset:-10%;
      background: radial-gradient(closest-side at 50% 45%, rgba(0,0,0,0), rgba(0,0,0,.65));
      pointer-events:none;
    }

    .caption{
      position:absolute;
      left:24px; bottom:22px;
      font-size: clamp(13px, 1.4vw, 16px);
      letter-spacing:.3px;
      color: rgba(255,245,210,.8);
      text-shadow: 0 10px 40px rgba(0,0,0,.65);
      text-transform: uppercase;
      opacity:.9;
    }

    /* Matrix + terminal takeover */
    .matrixOverlay{
      position:fixed; inset:0;
      background:#000;
      display:none;
      overflow:hidden;
      z-index:900;
    }
    .matrixOverlay.show{display:block;}
    .matrixCanvas{
      position:absolute; inset:0;
      width:100%; height:100%;
      background:#000;
      opacity:0;
      transition: opacity .6s ease;
    }
    .matrixOverlay.active .matrixCanvas{opacity:1;}
    .matrixOverlay.terminalMode .matrixCanvas{opacity:0;}
    .terminal{
      position:absolute; inset:0;
      padding:24px;
      background:#000;
      color:#43ff9b;
      font-family: "SFMono-Regular", Menlo, Consolas, "Liberation Mono", monospace;
      font-size:16px;
      line-height:1.6;
      display:flex;
      align-items:flex-start;
      justify-content:flex-start;
      opacity:0;
      transition: opacity .6s ease;
      overflow:hidden;
    }
    .matrixOverlay.terminalMode .terminal{opacity:1;}
    .terminalText{
      flex:1;
      width:100%;
      height:100%;
      white-space: pre-wrap;
      word-break: break-word;
      overflow-y:auto;
      max-height: calc(100vh - 48px);
      padding-right:6px;
    }
    .cursor{
      display:inline-block;
      width:10px; height:18px;
      background:#43ff9b;
      margin-top:2px;
    }
    .cursor.blink{ animation: blink 1s steps(2, start) infinite; }
    @keyframes blink{ to{ opacity:0; } }

    /* Malware-ish popup */
    .alert{
      position:fixed; inset:0;
      display:none;
      place-items:center;
      background: rgba(0,0,0,.78);
      z-index:950;
    }
    .alert.show{display:grid;}
    .alertBox{
      width:min(540px, 94vw);
      background: #0d0d0d;
      border:3px solid #ff0000;
      box-shadow: 0 20px 60px rgba(0,0,0,.75);
      padding:18px 18px 16px;
      font-family: "SFMono-Regular", Menlo, Consolas, "Liberation Mono", monospace;
      color:#ffdfdf;
      text-transform: uppercase;
      letter-spacing:.8px;
    }
    .alertHead{
      display:flex;
      justify-content:space-between;
      align-items:center;
      background:#1a1a1a;
      border:2px solid #ff0000;
      padding:8px 10px;
      font-weight:800;
    }
    .alertBody{
      padding:14px 8px 6px;
      line-height:1.5;
    }
    .alertBtns{
      display:flex;
      justify-content:flex-end;
      gap:10px;
      padding:10px 2px 0;
    }
    .btnRect{
      cursor:pointer;
      border:2px solid #ff0000;
      background:#0a0a0a;
      color:#ffdfdf;
      padding:10px 14px;
      font-weight:800;
      letter-spacing:1px;
      text-transform: uppercase;
      min-width:110px;
      box-shadow: inset 0 0 0 1px rgba(255,0,0,.35), 0 6px 16px rgba(0,0,0,.45);
      transition: transform .1s ease, background .2s ease, color .2s ease;
    }
    .btnRect:hover{ transform: translateY(-2px); background:#1a1a1a; color:#fff; }
    .btnRect:active{ transform: translateY(0); }
    .btnRect.primary{ background:#ff0000; color:#0d0d0d; }
    .btnRect.primary:hover{ background:#ff3b3b; color:#000; }

    @media (max-width: 900px){
      .road{ width: 220vw; }
      .city{ width: 200vw; }
      .caption{ left:16px; bottom:16px; }
    }
  </style>
</head>
<body>
  <div class="scene" id="scene">
    <div class="aurora" aria-hidden="true"></div>
    <div class="mist" aria-hidden="true"></div>
    <div class="mist mist2" aria-hidden="true"></div>

    <div class="travel" aria-hidden="true">
      <div class="road"></div>
      <div class="roadGlow"></div>

      <div class="city" id="city">
        <div class="crystal major" style="left:50%; width:16vw; height:70vh; --z:260px; --twist:-6deg; --alpha:.95; --i:1;"></div>
        <div class="crystal major" style="left:36%; width:12vw; height:58vh; --z:220px; --twist:4deg; --alpha:.9; --i:2;"></div>
        <div class="crystal major" style="left:65%; width:13vw; height:62vh; --z:230px; --twist:-2deg; --alpha:.9; --i:3;"></div>
        <div class="crystal major" style="left:22%; width:10vw; height:46vh; --z:170px; --twist:8deg; --alpha:.85; --i:4;"></div>
        <div class="crystal major" style="left:78%; width:10vw; height:48vh; --z:180px; --twist:-8deg; --alpha:.85; --i:5;"></div>
      </div>
    </div>

    <canvas id="spark"></canvas>
    <div class="vignette" aria-hidden="true"></div>
    <div class="caption">Follow the Yellow Brick Road</div>
  </div>

  <div class="matrixOverlay" id="matrix" aria-hidden="true">
    <canvas class="matrixCanvas" id="matrixCanvas"></canvas>
    <div class="terminal" id="terminal">
      <div class="terminalText" id="terminalText"><span class="cursor" id="cursor"></span></div>
    </div>
  </div>

  <div class="alert" id="alert" role="dialog" aria-modal="true" aria-label="Thaumaturlogical Event">
    <div class="alertBox">
      <div class="alertHead">
        <span>System Notification</span>
        <span style="color:#ff0000;">!!!</span>
      </div>
      <div class="alertBody">
        Congratulations! You have been chosen for a <b style="color:#ff0000;">thaumaturlogical</b> event!
        Click/Tap <b style="color:#ff0000;">HERE</b> to continue.
      </div>
      <div class="alertBtns">
        <button class="btnRect">Cancel</button>
        <button class="btnRect primary" id="alertConfirm">HERE</button>
      </div>
    </div>
  </div>

  <script>
    const city = document.getElementById('city');

    const fillerCount = 46;
    for(let i=0;i<fillerCount;i++){
      const c = document.createElement('div');
      c.className = 'crystal';
      const x = Math.random() * 100;
      const w = 3.5 + Math.random() * 7;
      const h = 20 + Math.random() * 52;
      const z = 60 + Math.random() * 220;
      const twist = (Math.random() * 18 - 9).toFixed(1);
      const alpha = (0.6 + Math.random() * 0.35).toFixed(2);
      c.style.left = x + '%';
      c.style.width = w + 'vw';
      c.style.height = h + 'vh';
      c.style.setProperty('--z', z + 'px');
      c.style.setProperty('--twist', twist + 'deg');
      c.style.setProperty('--alpha', alpha);
      c.style.setProperty('--i', i + 6);
      city.appendChild(c);
    }

    const foregroundCount = 10;
    for(let i=0;i<foregroundCount;i++){
      const c = document.createElement('div');
      c.className = 'crystal foreground';
      const onLeft = i % 2 === 0;
      const x = onLeft ? (4 + Math.random() * 20) : (76 + Math.random() * 20);
      const w = 10 + Math.random() * 8;
      const h = 35 + Math.random() * 30;
      const z = 20 + Math.random() * 80;
      const twist = (Math.random() * 10 - 5).toFixed(1);
      const alpha = (0.55 + Math.random() * 0.3).toFixed(2);
      c.style.left = x + '%';
      c.style.width = w + 'vw';
      c.style.height = h + 'vh';
      c.style.setProperty('--z', z + 'px');
      c.style.setProperty('--twist', twist + 'deg');
      c.style.setProperty('--alpha', alpha);
      c.style.setProperty('--i', i + 60);
      city.appendChild(c);
    }

    const canvas = document.getElementById('spark');
    const ctx = canvas.getContext('2d');
    let W = 0, H = 0, DPR = 1;

    function resize(){
      DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      W = Math.floor(window.innerWidth * DPR);
      H = Math.floor(window.innerHeight * DPR);
      canvas.width = W;
      canvas.height = H;
    }
    window.addEventListener('resize', resize);
    resize();

    const stars = Array.from({length: 120}, ()=>({
      x: Math.random(),
      y: Math.random() * 0.7,
      r: 0.4 + Math.random() * 1.4,
      tw: 0.6 + Math.random() * 1.8,
      a: 0.2 + Math.random() * 0.6
    }));

    function draw(t){
      ctx.clearRect(0,0,W,H);
      for(const s of stars){
        const tw = 0.6 + 0.4 * Math.sin((t/1000) * s.tw + s.x * 6.2);
        const alpha = s.a * tw;
        ctx.beginPath();
        ctx.arc(s.x * W, s.y * H, s.r * DPR, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(180,255,230,${alpha})`;
        ctx.fill();
      }
      requestAnimationFrame(draw);
    }
    requestAnimationFrame(draw);

    // ========= Matrix rain + terminal typing =========
    const matrixOverlay = document.getElementById('matrix');
    const matrixCanvas = document.getElementById('matrixCanvas');
    const mtx = matrixCanvas.getContext('2d');
    const terminal = document.getElementById('terminal');
    const terminalText = document.getElementById('terminalText');
    const cursor = document.getElementById('cursor');

    let genesisText = '';
    let genesisLoaded = false;
    const genesisReady = fetch('assets/genesis.txt', { cache: 'no-store' })
      .then((r)=> r.text())
      .then((t)=> { genesisText = t.trim(); genesisLoaded = true; })
      .catch(()=> { genesisText = 'Genesis text missing. Place it at assets/genesis.txt'; genesisLoaded = true; });

    let stageText = '';
    let stageLoaded = false;
    const stageReady = fetch('assets/stage-1.txt', { cache: 'no-store' })
      .then((r)=> r.text())
      .then((t)=> { stageText = t.trim(); stageLoaded = true; })
      .catch(()=> { stageText = 'stage-1.txt missing. Place it at assets/stage-1.txt'; stageLoaded = true; });

    let matrixRunning = false;
    let matrixLocked = false;
    let matrixW = 0, matrixH = 0;
    const matrixFont = 16;
    let drops = [];
    const matrixChars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';

    function resizeMatrix(){
      matrixW = window.innerWidth;
      matrixH = window.innerHeight;
      matrixCanvas.width = matrixW;
      matrixCanvas.height = matrixH;
      const cols = Math.max(1, Math.floor(matrixW / matrixFont));
      drops = new Array(cols).fill(1);
    }
    window.addEventListener('resize', resizeMatrix);

    function drawMatrix(){
      if(!matrixRunning) return;
      mtx.fillStyle = 'rgba(0,0,0,0.08)';
      mtx.fillRect(0,0,matrixW,matrixH);
      mtx.fillStyle = '#0f0';
      mtx.font = `${matrixFont}px SFMono-Regular, monospace`;
      for(let i=0; i<drops.length; i++){
        const text = matrixChars.charAt(Math.floor(Math.random() * matrixChars.length));
        mtx.fillText(text, i * matrixFont, drops[i] * matrixFont);
        if(drops[i] * matrixFont > matrixH && Math.random() > 0.975){ drops[i] = 0; }
        drops[i]++;
      }
      requestAnimationFrame(drawMatrix);
    }

    function startMatrix(){
      matrixOverlay.classList.add('show','active');
      matrixRunning = true;
      resizeMatrix();
      drawMatrix();
    }
    function stopMatrix(){ matrixRunning = false; }

    function typeContent(content, color, done){
      const text = content && content.length ? content : 'Text missing.';
      let index = 0;
      let buffer = '';
      terminal.style.color = color;
      cursor.style.background = color;
      cursor.classList.remove('blink');
      cursor.style.opacity = '1';
      terminalText.textContent = '';
      terminalText.appendChild(cursor);
      function step(){
        if(index >= text.length){
          cursor.classList.add('blink');
          if(done) done();
          return;
        }
        const chunk = text.slice(index, index + 220);
        buffer += chunk;
        terminalText.textContent = buffer;
        terminalText.appendChild(cursor);
        index += chunk.length;
        terminalText.scrollTop = terminalText.scrollHeight;
        requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    }

    function startTerminalPhase(){
      terminalText.textContent = '';
      terminalText.appendChild(cursor);
      cursor.classList.remove('blink');
      cursor.style.opacity = '1';
      let flashes = 0;
      let visible = true;
      const flashInterval = setInterval(()=>{
        visible = !visible;
        cursor.style.opacity = visible ? '1' : '0';
        if(!visible){
          flashes++;
          if(flashes >= 3){
            clearInterval(flashInterval);
            cursor.style.opacity = '1';
            const startTyping = ()=>{
              typeContent(genesisText && genesisText.length ? genesisText : 'Genesis text missing. Add assets/genesis.txt', '#43ff9b', showAlert);
            };
            if(!genesisLoaded){ genesisReady.finally(startTyping); } else { startTyping(); }
          }
        }
      }, 240);
    }

    function triggerMatrix(){
      if(matrixLocked) return;
      matrixLocked = true;
      startMatrix();
      setTimeout(()=>{
        matrixOverlay.classList.add('terminalMode');
        stopMatrix();
        genesisReady.finally(startTerminalPhase);
      }, 3600);
    }

    let clickCount = 0;
    let clickTimer;
    window.addEventListener('click', ()=>{
      clickCount++;
      clearTimeout(clickTimer);
      clickTimer = setTimeout(()=> { clickCount = 0; }, 750);
      if(clickCount >= 3){
        clickCount = 0;
        triggerMatrix();
      }
    }, {passive:true});

    // ========= Popup + stage 2 typing =========
    const alertEl = document.getElementById('alert');
    const alertConfirm = document.getElementById('alertConfirm');
    function showAlert(){ alertEl.classList.add('show'); }
    function hideAlert(){ alertEl.classList.remove('show'); }

    alertConfirm.addEventListener('click', ()=>{
      hideAlert();
      const startStage = ()=>{
        typeContent(stageText && stageText.length ? stageText : 'stage-1.txt missing. Place it at assets/stage-1.txt', '#ff6fb7');
      };
      if(!stageLoaded){ stageReady.finally(startStage); } else { startStage(); }
    });
  </script>
</body>
</html>
